<div class="">
  <div class="row g-0 con-height align-items-stretch">
    <div
      class="col-lg-6 pt-5 pb-5 bg-contact d- alighn-items-center justify-content-center justify-content-center"
    >
      <div class="card mw-600 p-4 stepper-card mx-auto w-100">
        <!-- Step indicator -->
        <div class="d-flex justify-content-between mb-4">
          <div class="d-flex gap-2">
            <ng-container *ngFor="let s of [1, 2, 3, 4]">
              <button
                class="btn btn-sm"
                [ngClass]="
                  step === s ? 'bt-color text-white' : 'btn-outline-secondary'
                "
                (click)="goTo(s)"
              >
                {{ s }}
              </button>
            </ng-container>
          </div>
          <small class="text-muted">Step {{ step }} of {{ maxStep }}</small>
        </div>

        <form [formGroup]="bookingForm" (ngSubmit)="submitForm()">
          <!-- ========== STEP 1 ========== -->
          <div *ngIf="step === 1" [formGroup]="clientGroup">
            <h5 class="mb-3 fs-4 text-center">
              Get in Touch This Festive Season
            </h5>
            <p class="mb-3">
              Fill out the form below and our team will get back to you
              promptly.
            </p>

            <div class="row g-3">
              <div class="col-md-12">
                <label class="form-label">Client Type</label>
                <select
                  class="form-select"
                  formControlName="clientType"
                  [ngClass]="{
                    'is-invalid': isInvalid(clientGroup, 'clientType')
                  }"
                >
                  <option value="individual">Individual</option>
                  <option value="organization">Organization</option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(clientGroup, "clientType") }}
                </div>
              </div>

              <div class="col-md-12">
                <label class="form-label">Organization / Full Name</label>
                <input
                  class="form-control"
                  formControlName="organizationOrName"
                  placeholder="Enter full name"
                  [ngClass]="{
                    'is-invalid': isInvalid(clientGroup, 'organizationOrName')
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(clientGroup, "organizationOrName") }}
                </div>
              </div>

              <div class="col-md-12">
                <label class="form-label">Contact Person</label>
                <input
                  class="form-control"
                  formControlName="contactPerson"
                  placeholder="Contact person"
                />
              </div>

              <div class="col-md-12">
                <label class="form-label">Phone</label>
                <input
                  class="form-control"
                  formControlName="phone"
                  [ngClass]="{ 'is-invalid': isInvalid(clientGroup, 'phone') }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(clientGroup, "phone") }}
                </div>
              </div>

              <div class="col-md-12">
                <label class="form-label">Alternative Phone</label>
                <input class="form-control" formControlName="altPhone" />
              </div>

              <div class="col-md-12">
                <label class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  formControlName="email"
                  [ngClass]="{ 'is-invalid': isInvalid(clientGroup, 'email') }"
                />
              </div>

              <div class="col-12 mt-2" [formGroup]="preferredContactGroup">
                <label class="form-label d-block"
                  >Preferred Contact Method</label
                >

                <div
                  class="rounded"
                  [ngClass]="{
                    'p-2 border border-danger': isGroupInvalid(
                      preferredContactGroup
                    )
                  }"
                >
                  <div class="form-check custom-checkbox form-check-inline">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      formControlName="phone"
                    />
                    <label class="form-check-label">Phone</label>
                  </div>

                  <div class="form-check form-check-inline">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      formControlName="email"
                    />
                    <label class="form-check-label">Email</label>
                  </div>

                  <div class="form-check form-check-inline">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      formControlName="whatsapp"
                    />
                    <label class="form-check-label">WhatsApp</label>
                  </div>
                </div>

                <!-- Error message -->
                <div
                  class="text-danger small mt-1"
                  *ngIf="isGroupInvalid(preferredContactGroup)"
                >
                  Please select at least one preferred contact method.
                </div>
              </div>
            </div>
          </div>
          <!-- ========== STEP 2 ========== -->
          <div *ngIf="step === 2" [formGroup]="serviceGroup">
            <h5 class="mb-3 fs-4 text-center">Step 2 - Service Requirement</h5>
            <button
              class="mt-3 mb-3 px-2 back-button gap-2 btn btn-sm bg-scondary"
              (click)="back()"
            >
              <img
                height="5"
                width="5"
                src="/assets/images/arrow-left.png"
                alt=""
              />Back
            </button>
            <div class="row g-3">
              <div class="col-md-12">
                <label class="form-label">Service Type</label>
                <select
                  class="form-select"
                  formControlName="serviceType"
                  [ngClass]="{
                    'is-invalid': isInvalid(serviceGroup, 'serviceType')
                  }"
                >
                  <option
                    value="{{ service.name }}"
                    *ngFor="let service of services"
                  >
                    {{ service.name }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(serviceGroup, "serviceType") }}
                </div>
              </div>
              <!-- DSP-->
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Driver Support Services'
                "
              >
                <label class="form-label">Services</label>
                <select
                  class="form-select"
                  formControlName="service"
                  [ngClass]="{
                    'is-invalid': isInvalid(serviceGroup, 'service')
                  }"
                >
                  <option
                    value="{{ service.name }}"
                    *ngFor="let service of driverServices"
                  >
                    {{ service.name }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(serviceGroup, "service") }}
                </div>
              </div>
              <div
                class="col-md-12 mt-3"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Driver Support Services'
                "
              >
                <label class="form-label">Service Duration</label>
                <select class="form-select" formControlName="serviceDuration">
                  <option [ngValue]="null">Select Duration</option>
                  <option value="day">Day Hire</option>
                  <option value="weekly">Weekly Hire</option>
                  <option value="monthly">Monthly Hire</option>
                  <option value="temporary">Temporary</option>
                  <option value="permanent">Permanent</option>
                </select>
              </div>
              <!--Premium-->
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Premium Vehicle Services'
                "
              >
                <label class="form-label">Services</label>
                <select
                  class="form-select"
                  formControlName="service"
                  [ngClass]="{
                    'is-invalid': isInvalid(serviceGroup, 'service')
                  }"
                >
                  <option
                    title="{{ service.title }}"
                    value="{{ service.name }}"
                    *ngFor="let service of premiumServices"
                  >
                    {{ service.name }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(serviceGroup, "service") }}
                </div>
              </div>
              <div
                class="mt-3"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Premium Vehicle Services'
                "
              >
                <div class="info-box status">
                  <div class="info-icon"><mat-icon>info</mat-icon></div>
                  <div class="info-content">
                    <h4>Premium Vehicles Services</h4>
                    <p>
                      Vehicle seats more passengers, but we cap occupancy for
                      comfort.
                    </p>
                  </div>
                </div>
              </div>
              <!--secured escort-->
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Secured Escort Services'
                "
              >
                <label class="form-label">Services</label>
                <select
                  class="form-select"
                  formControlName="service"
                  [ngClass]="{
                    'is-invalid': isInvalid(serviceGroup, 'service')
                  }"
                >
                  <option
                    value="{{ service.name }}"
                    *ngFor="let service of securedEscortServices"
                  >
                    {{ service.name }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(serviceGroup, "service") }}
                </div>
              </div>
              <!--secure mobility-->
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Secured Mobility Services'
                "
              >
                <label class="form-label">Services</label>
                <select
                  class="form-select"
                  formControlName="service"
                  [ngClass]="{
                    'is-invalid': isInvalid(serviceGroup, 'service')
                  }"
                >
                  <option
                    value="{{ service.name }}"
                    *ngFor="let service of mobilityServices"
                  >
                    {{ service.name }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(serviceGroup, "service") }}
                </div>
              </div>
              <!--cpo-->
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Close Protection Detail'
                "
              >
                <label class="form-label">Services</label>
                <select
                  class="form-select"
                  formControlName="service"
                  (change)="onCPOServiceChange()"
                  [ngClass]="{
                    'is-invalid': isInvalid(serviceGroup, 'service')
                  }"
                >
                  <option
                    value="{{ service.name }}"
                    *ngFor="let service of cpoServices"
                  >
                    {{ service.name }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(serviceGroup, "service") }}
                </div>
              </div>

              <!-- Service Duration for Close Protection Detail -->
              <div
                class="col-md-12 mt-3"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Close Protection Detail'
                "
              >
                <label class="form-label">Service Duration</label>
                <select
                  class="form-select"
                  formControlName="serviceDuration"
                  [ngClass]="{
                    'is-invalid': isInvalid(serviceGroup, 'serviceDuration')
                  }"
                >
                  <option [ngValue]="null">Select Duration</option>

                  <!-- Show both options for Unarmed CPO -->
                  <option
                    *ngIf="
                      serviceGroup.get('service')?.value === 'Unarmed CPO' ||
                      serviceGroup.get('service')?.value === 'Full Options CPO'
                    "
                    value="full-day"
                  >
                    Full Day [6-12 Hours]
                  </option>

                  <!-- Show only for Unarmed CPO -->
                  <option
                    *ngIf="serviceGroup.get('service')?.value === 'Unarmed CPO'"
                    value="half-day"
                  >
                    Half Day [1-6 Hours]
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(serviceGroup, "serviceDuration") }}
                </div>
              </div>
              <!--event security-->
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Event Security Services'
                "
              >
                <label class="form-label">Event Service Type</label>
                <select
                  class="form-select"
                  formControlName="service"
                  [ngClass]="{
                    'is-invalid': isInvalid(serviceGroup, 'service')
                  }"
                >
                  <option value="">Select Event Service</option>
                  <option
                    value="{{ service.name }}"
                    *ngFor="let service of eventServices"
                  >
                    {{ service.name }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(serviceGroup, "eventService") }}
                </div>
              </div>
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                    'Event Security Services' &&
                  serviceGroup.get('service')?.value === 'Others'
                "
              >
                <label class="form-label">Please Specify Event Type</label>
                <input
                  type="text"
                  class="form-control"
                  formControlName="customEventType"
                  placeholder="Enter the specific event type (e.g., Product Launch, Gala Dinner, etc.)"
                  [ngClass]="{
                    'is-invalid': isInvalid(serviceGroup, 'customEventType')
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(serviceGroup, "customEventType") }}
                </div>
                <small class="text-muted"
                  >Please describe the type of event you need security services
                  for.</small
                >
              </div>

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Event Security Services'
                "
              >
                <label class="form-label">Security Needs</label>
                <select
                  class="form-select"
                  formControlName="securityNeeds"
                  [ngClass]="{
                    'is-invalid': isInvalid(serviceGroup, 'securityNeeds')
                  }"
                >
                  <option value="">Select Security Needs</option>
                  <option
                    title="{{ need.desc }}"
                    value="{{ need.name }}"
                    *ngFor="let need of securityNeeds"
                  >
                    {{ need.name }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(serviceGroup, "securityNeeds") }}
                </div>
              </div>
              <!-- Custom Event Type Input (shown only when "Others" is selected) -->

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Event Security Services'
                "
              >
                <label class="form-label">Support Needs</label>
                <select
                  class="form-select"
                  formControlName="supportNeeds"
                  [ngClass]="{
                    'is-invalid': isInvalid(serviceGroup, 'supportNeeds')
                  }"
                >
                  <option value="">Select Support Needs</option>
                  <option
                    value="{{ need.name }}"
                    *ngFor="let need of supportNeeds"
                  >
                    {{ need.name }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(serviceGroup, "supportNeeds") }}
                </div>
              </div>
            </div>
          </div>

          <!-- ========== STEP 3 ========== -->

          <div *ngIf="step === 3" [formGroup]="movementGroup">
            <h5 class="mb-3 fs-4 text-center">Step 3 - Service Details</h5>

            <button
              class="mt-3 mb-3 px-2 back-button gap-2 btn btn-sm bg-scondary"
              (click)="back()"
            >
              <img
                height="5"
                width="5"
                src="/assets/images/arrow-left.png"
                alt=""
              />Back
            </button>

            <div class="row g-3">
              <!-- Close Protection Detail Fields -->
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Close Protection Detail'
                "
              >
                <label class="form-label">Service Commencement</label>
                <input
                  type="date"
                  class="form-control"
                  formControlName="serviceCommencement"
                  [ngClass]="{
                    'is-invalid': isInvalid(
                      movementGroup,
                      'serviceCommencement'
                    )
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "serviceCommencement") }}
                </div>
              </div>

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Close Protection Detail'
                "
              >
                <label class="form-label">Service Location</label>
                <input
                  class="form-control"
                  formControlName="serviceLocation"
                  placeholder="Enter service location"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'serviceLocation')
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "serviceLocation") }}
                </div>
              </div>

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Close Protection Detail'
                "
              >
                <label class="form-label">Service Level</label>
                <select
                  class="form-select"
                  formControlName="serviceLevel"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'serviceLevel')
                  }"
                >
                  <option [ngValue]="null">Select Service Level</option>
                  <option
                    [value]="lvl"
                    *ngFor="let lvl of ['Regular', 'Premium', 'Bespoke']"
                  >
                    {{ lvl }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "serviceLevel") }}
                </div>
              </div>

              <!-- Optional Add-Ons for Close Protection Detail -->

              <!-- Driver Support Services Fields -->
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Driver Support Services'
                "
              >
                <label class="form-label">Service Commencement</label>
                <input
                  type="date"
                  class="form-control"
                  formControlName="serviceCommencement"
                  [ngClass]="{
                    'is-invalid': isInvalid(
                      movementGroup,
                      'serviceCommencement'
                    )
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "serviceCommencement") }}
                </div>
              </div>

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Driver Support Services'
                "
              >
                <label class="form-label">Service Location</label>
                <input
                  class="form-control"
                  formControlName="serviceLocation"
                  placeholder="Enter service location"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'serviceLocation')
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "serviceLocation") }}
                </div>
              </div>

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Driver Support Services'
                "
              >
                <label class="form-label">Service Level</label>
                <select
                  class="form-select"
                  formControlName="serviceLevel"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'serviceLevel')
                  }"
                >
                  <option [ngValue]="null">Select Service Level</option>
                  <option
                    [value]="lvl"
                    *ngFor="let lvl of ['Regular', 'Premium', 'Bespoke']"
                  >
                    {{ lvl }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "serviceLevel") }}
                </div>
              </div>

              <!-- Regular Service Fields (shown for other services except Event, Driver Support, and Close Protection) -->
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value !==
                    'Event Security Services' &&
                  serviceGroup.get('serviceType')?.value !==
                    'Driver Support Services' &&
                  serviceGroup.get('serviceType')?.value !==
                    'Close Protection Detail'
                "
              >
                <label class="form-label">Service Commencement</label>
                <input
                  type="date"
                  class="form-control"
                  formControlName="serviceCommencement"
                  [ngClass]="{
                    'is-invalid': isInvalid(
                      movementGroup,
                      'serviceCommencement'
                    )
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "serviceCommencement") }}
                </div>
              </div>

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value !==
                    'Event Security Services' &&
                  serviceGroup.get('serviceType')?.value !==
                    'Driver Support Services' &&
                  serviceGroup.get('serviceType')?.value !==
                    'Close Protection Detail'
                "
              >
                <label class="form-label">Expected Duration (Hours)</label>
                <input
                  class="form-control"
                  formControlName="expectedDuration"
                  placeholder="e.g. 4 hours"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'expectedDuration')
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "expectedDuration") }}
                </div>
              </div>

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value !==
                    'Event Security Services' &&
                  serviceGroup.get('serviceType')?.value !==
                    'Driver Support Services' &&
                  serviceGroup.get('serviceType')?.value !==
                    'Close Protection Detail'
                "
              >
                <label class="form-label">Service Location</label>
                <input
                  class="form-control"
                  formControlName="serviceLocation"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'serviceLocation')
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "serviceLocation") }}
                </div>
              </div>

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value !==
                    'Event Security Services' &&
                  serviceGroup.get('serviceType')?.value !==
                    'Driver Support Services' &&
                  serviceGroup.get('serviceType')?.value !==
                    'Close Protection Detail'
                "
              >
                <label class="form-label">Destination Address</label>
                <input
                  class="form-control"
                  formControlName="destinationAddress"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'destinationAddress')
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "destinationAddress") }}
                </div>
              </div>

              <div
                class="col-md-12 mt-2"
                *ngIf="
                  serviceGroup.get('serviceType')?.value !==
                    'Event Security Services' &&
                  serviceGroup.get('serviceType')?.value !==
                    'Driver Support Services' &&
                  serviceGroup.get('serviceType')?.value !==
                    'Close Protection Detail'
                "
              >
                <label class="form-label">Number of vehicles</label>
                <select
                  class="form-select"
                  formControlName="numberofVehicles"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'numberofVehicles')
                  }"
                >
                  <option [ngValue]="null">Select</option>
                  <option
                    [value]="v"
                    *ngFor="let v of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]"
                  >
                    {{ v }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "numberofVehicles") }}
                </div>
              </div>

              <!-- Event Service Fields (shown only for event services) -->
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Event Security Services'
                "
              >
                <label class="form-label">Event Date</label>
                <input
                  type="date"
                  class="form-control"
                  formControlName="eventDate"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'eventDate')
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "eventDate") }}
                </div>
              </div>

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Event Security Services'
                "
              >
                <label class="form-label">Expected Duration (Hours)</label>
                <input
                  class="form-control"
                  formControlName="expectedDuration"
                  placeholder="e.g. 4 hours"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'expectedDuration')
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "expectedDuration") }}
                </div>
              </div>

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Event Security Services'
                "
              >
                <label class="form-label">Event/Venue Location</label>
                <input
                  class="form-control"
                  formControlName="eventVenueLocation"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'eventVenueLocation')
                  }"
                />
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "eventVenueLocation") }}
                </div>
              </div>

              <div
                class="col-md-12 mt-2"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Event Security Services'
                "
              >
                <label class="form-label">High Profile Guests Expected ?</label>
                <select
                  class="form-select"
                  formControlName="highProfileGuestsExpected"
                  [ngClass]="{
                    'is-invalid': isInvalid(
                      movementGroup,
                      'highProfileGuestsExpected'
                    )
                  }"
                >
                  <option [ngValue]="null">Select</option>
                  <option [value]="v" *ngFor="let v of ['Yes', 'No']">
                    {{ v }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "highProfileGuestsExpected") }}
                </div>
              </div>

              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value ===
                  'Event Security Services'
                "
              >
                <label class="form-label">Any Known Risks or Concerns</label>
                <textarea
                  class="form-control"
                  formControlName="knownRisksOrConcerns"
                  rows="3"
                  placeholder="Please describe any known risks, security concerns, or special requirements..."
                  [ngClass]="{
                    'is-invalid': isInvalid(
                      movementGroup,
                      'knownRisksOrConcerns'
                    )
                  }"
                ></textarea>
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "knownRisksOrConcerns") }}
                </div>
              </div>

              <!-- Service Level for non-Driver Support and non-Close Protection Services -->
              <div
                class="col-md-12"
                *ngIf="
                  serviceGroup.get('serviceType')?.value !==
                    'Driver Support Services' &&
                  serviceGroup.get('serviceType')?.value !==
                    'Close Protection Detail'
                "
              >
                <label class="form-label">Service Levels</label>
                <select
                  class="form-select"
                  formControlName="serviceLevel"
                  [ngClass]="{
                    'is-invalid': isInvalid(movementGroup, 'serviceLevel')
                  }"
                >
                  <option [ngValue]="null">Select Service Levels</option>
                  <option
                    [value]="lvl"
                    *ngFor="let lvl of ['Regular', 'Premium', 'Bespoke']"
                  >
                    {{ lvl }}
                  </option>
                </select>
                <div class="invalid-feedback">
                  {{ errorMessage(movementGroup, "serviceLevel") }}
                </div>
              </div>

              <!-- Optional Add-Ons for other services (hidden for events, driver support, and close protection) -->
              <div class="mt-3">
                <label class="form-label">Optional Add-Ons</label>
                <div
                  *ngFor="
                    let a of [
                      'Pre-Event Route & Risk Mapping',
                      'Dedicated Halogen Support Officer',
                      'Overnight Security Provision',
                      'Additional Vehicle Support'
                    ]
                  "
                  class="form-check"
                >
                  <input
                    type="checkbox"
                    class="form-check-input"
                    (change)="toggleAddOn(a, $any($event.target).checked)"
                  />
                  <label class="form-check-label">{{ a | titlecase }}</label>
                </div>
              </div>
            </div>
          </div>

          <div
            class="d-flex flex-column align-items-center justify-content-between"
            *ngIf="step === 4"
          >
            <h4 class="fs-3 text-center fw-bold">
              Request Submitted Successfully!
            </h4>

            <img
              src="/assets/images/requestsubmit.png"
              alt=""
              class="submit-img"
            />
            <p class="text-muted">
              Thank you! Your request has been received. Our team will contact
              you within the next 24 hours.
            </p>
            <!-- <div class="alert alert-light border">
              <h6>Submitted Data:</h6>
              <pre>{{ bookingForm.value | json }}</pre>
            </div> -->

            <button type="button" routerLink="/" class="submit-btn mt-3">
              Return To Homepage
            </button>
            <button
              class="mt-3 btn btn-primary"
              type="button"
              (click)="step = 1"
            >
              Start New Request
            </button>
          </div>

          <!-- ========== Navigation Buttons ========== -->
          <div class="" *ngIf="step < 4">
            <button
              type="button"
              class="submit-btn mt-3"
              (click)="next()"
              *ngIf="step < 3"
              [disabled]="isLoading"
            >
              Next
            </button>
          </div>

          <div class="">
            <button
              type="submit"
              class="submit-btn mt-3"
              *ngIf="step === 3"
              [disabled]="isLoading || bookingForm.invalid"
            >
              <span *ngIf="!isLoading">Submit</span>
              <span *ngIf="isLoading">
                <span
                  class="spinner-border spinner-border-sm me-2"
                  role="status"
                  aria-hidden="true"
                ></span>
                Processing...
              </span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="col-lg-6 d-flex image-container">
      <img
        src="assets/images/primary.png"
        class="big-img w-100"
        alt="working"
      />
      <div class="overlay"></div>
    </div>
  </div>
</div>
